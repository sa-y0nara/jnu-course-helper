# JNU 选课助手 

这是一个为JNU本科生选课系统设计的油猴脚本（UserScript），旨在帮助学生在选课阶段自动化地、高频率地提交选课请求，以提高选上心仪课程的成功率。

**最新版本 v3 核心改进：** 引入了**统一凭证机制**。脚本现在会自动捕获并使用您在选课页面上**最后一次**操作时产生的 `Token` 和 `Cookie`。这意味着，只要您在选课前在同浏览器页面有任意一次成功的选课或刷新操作，脚本就能获取到最新的有效凭证，极大地提高了选课请求的成功率和有效性，避免了因凭证过期导致的失败。

## 目录

  - [✨ 功能特性]
  - [🔧 安装方法]
  - [📖 使用说明]
      - [第一步：捕获选课请求]
      - [第二步：设置选课参数]
      - [第三步：锁定并等待执行]
  - [⚠️ 重要提示]
  - [📜 免责声明]
  - [📄 开源许可]

## ✨ 功能特性

  - **请求捕获**: 自动拦截并保存您在选课页面上发出的选课请求（兼容 Fetch 和 XHR）。
  - **统一凭证管理 (v3)**: 自动捕获并使用**最后一次**网络请求中的 `Token` 和 `Cookie` 作为所有选课请求的统一凭证，最大限度保证身份验证的有效性。
  - **定时选课**: 可精确设置选课任务的开始时间（年月日时分）。
  - **高频发包**: 自定义请求发送的间隔时间（单位：毫秒）和持续时间（单位：秒）。
  - **可视化操作界面**: 提供一个悬浮的操作面板，可以方便地进行所有设置，并实时查看日志和状态。
  - **持久化存储**: 捕获的课程列表会自动保存在浏览器中，刷新页面不会丢失。
  - **实时日志**: 清晰地展示脚本的每一个动作，包括请求的发送、服务器的响应等，方便排查问题。

## 🔧 安装方法

1.  **安装浏览器扩展**:

      * 您需要在浏览器上安装一个用户脚本管理器。推荐使用 [**Tampermonkey**](https://www.tampermonkey.net/) (油猴)，它支持 Chrome, Firefox, Edge, Safari 等主流浏览器。

2.  **安装本脚本**:

      * 点击此处的安装链接：[**安装 JNU 选课助手**](https://github.com/sa-y0nara/jnu-course-helper/releases/download/0.1/JNU.user.js)。
      * Tampermonkey 会自动弹出安装页面，点击“安装”即可。

3.  **验证安装**:

      * 安装完成后，访问暨南大学选课系统页面 (`https://jwxk.jnu.edu.cn/*`)。
      * 如果页面左侧出现了“JNU 选课助手 (v3)”的悬浮窗，则代表脚本已成功加载。

## 📖 使用说明

脚本的操作面板分为三个主要区域：**捕获控制**、**参数设置** 和 **状态显示**。

### 第一步：捕获选课请求

这是整个流程最关键的一步，目的是让脚本知道你想选哪些课，并获取有效的身份凭证。

1.  打开选课页面，找到你想要选的课程。
2.  在脚本面板中，点击 **`[开始捕获]`** 按钮。按钮会变为红色，并提示“停止捕获”。
3.  现在，**正常地在选课页面上点击“选课”按钮**，尝试选择你想要的课程（无论成功与否）。每点击一次，脚本就会捕获一个请求，并将其添加到“捕获的请求”列表中。
4.  **【重要】** 为了确保凭证最新有效，建议在正式选课开始前几分钟，再次点击任意一个课程的“选课”按钮，刷新脚本捕获到的 `Token` 和 `Cookie`。你可以从面板的“凭证状态”看到是否已成功捕获。
5.  捕获完所有你想要选的课程后，点击 **`[停止捕获]`** 按钮。

> **提示**:
>
>   * “凭证状态”显示为 **凭证已捕获** 才算成功。
>   * 如果你想选多门课程，可以重复第3步。脚本会按顺序轮流为这些课程发送请求。
>   * 点击 **`[清空列表]`** 会清除所有已捕获的课程和凭证，需要重新捕获。

### 第二步：设置选课参数

在这一步，你需要告诉脚本何时开始、以多快的速度选课。

1.  **选课开始时间**: 设置一个未来的精确时间点。例如，学校通知 `13:00:00` 开始，你可以设置为 `13:00:00`。
2.  **发包间隔(毫秒)**: 这是每个选课请求之间的间隔时间。建议设置在 `100` 到 `500` 毫秒之间。过低可能导致服务器拒绝或IP被封锁，过高则可能错过机会。默认值为 `200`。
3.  **持续时间(秒)**: 脚本将在这个设定的时间内持续发送请求。例如，设置为 `10` 秒，脚本会从开始时间起，持续发送10秒的请求。

### 第三步：锁定并等待执行

完成以上所有设置后，即可“上膛”准备。

1.  点击 **`[锁定设置 & 准备选课]`** 按钮。
2.  此时，所有设置项将被禁用，以防误触修改。按钮会变为绿色并显示“已锁定，等待执行...”。
3.  脚本将在你设定的时间点自动开始执行选课任务。你可以通过“日志输出”窗口实时观察选课过程和服务器返回的结果。

> **服务器响应解读**:
>
>   * 绿色 日志通常代表成功，例如包含 `"msg":"操作成功"` 的信息。
>   * 红色 日志代表失败或异常，例如“选课已满”、“不在选课时间”或“token失效”等。

## ⚠️ 重要提示

  * **凭证时效性**: `Token` 和 `Cookie` 是有有效期的。务必在选课开始前的几分钟内进行一次捕获操作，以刷新凭证，这是 v3 版本成功的关键。
  * **时间同步**: 请确保你的电脑本地时间与北京时间准确同步，否则定时任务会提前或延迟执行。
  * **单点登录**: 暨大系统为单点登录，在其他地方登录可能会导致当前页面的凭证失效。选课期间，请勿在其他设备或浏览器标签页上进行登录操作。
  * **不要过度依赖**: 本脚本仅为辅助工具，不能保证 100% 成功。请理性看待，做好手动选课的准备。
  * **低调使用**: 请勿在公开场合宣传或传播此脚本，以免引起不必要的注意。

## 📜 免责声明

本脚本为免费的开源项目，仅供学习和技术交流使用。作者不对使用本脚本可能造成的任何后果负责，包括但不限于：

  * 选课失败。
  * 因不当使用（如攻击性地设置超低间隔）导致的账号异常或被学校追责。
  * 因学校选课系统更新导致脚本失效。

**使用者在使用本脚本时，即表示已明确知晓并自愿承担所有潜在风险。**

## 📄 开源许可

本脚本遵循 [MIT License](https://opensource.org/licenses/MIT) 开源许可。
